var je=Object.defineProperty;var fe=r=>{throw TypeError(r)};var Ie=(r,e,t)=>e in r?je(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var p=(r,e,t)=>Ie(r,typeof e!="symbol"?e+"":e,t),M=(r,e,t)=>e.has(r)||fe("Cannot "+t);var n=(r,e,t)=>(M(r,e,"read from private field"),t?t.call(r):e.get(r)),w=(r,e,t)=>e.has(r)?fe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),g=(r,e,t,s)=>(M(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),h=(r,e,t)=>(M(r,e,"access private method"),t);var le=(r,e,t,s)=>({set _(o){g(r,e,o,t)},get _(){return n(r,e,s)}});import{w as Q}from"./C3bX-MBV.js";import{a as _}from"./Dsy1AHCi.js";class W extends Error{constructor(t,s,o){const a=t.status||t.status===0?t.status:"",u=t.statusText??"",d=`${a} ${u}`.trim(),f=d?`status code ${d}`:"an unknown error";super(`Request failed with ${f}: ${s.method} ${s.url}`);p(this,"response");p(this,"request");p(this,"options");this.name="HTTPError",this.response=t,this.request=s,this.options=o}}class pe extends Error{constructor(t){let s="Non-error value was thrown";try{typeof t=="string"?s=t:t&&typeof t=="object"&&"message"in t&&typeof t.message=="string"&&(s=t.message)}catch{}super(s);p(this,"name","NonError");p(this,"value");this.value=t}}class B extends Error{constructor(t){const s=t!=null&&t.cause?t.cause instanceof Error?t.cause:new pe(t.cause):void 0;super(t!=null&&t.code?`Forced retry: ${t.code}`:"Forced retry",s?{cause:s}:void 0);p(this,"name","ForceRetryError");p(this,"customDelay");p(this,"code");p(this,"customRequest");this.customDelay=t==null?void 0:t.delay,this.code=t==null?void 0:t.code,this.customRequest=t==null?void 0:t.request}}const de=(()=>{let r=!1,e=!1;const t=typeof globalThis.ReadableStream=="function",s=typeof globalThis.Request=="function";if(t&&s)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type")}catch(o){if(o instanceof Error&&o.message==="unsupported BodyInit type")return!1;throw o}return r&&!e})(),Pe=typeof globalThis.AbortController=="function",ye=typeof globalThis.AbortSignal=="function"&&typeof globalThis.AbortSignal.any=="function",Ce=typeof globalThis.ReadableStream=="function",Ne=typeof globalThis.FormData=="function",ge=["get","post","put","patch","head","delete"],Le={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*",bytes:"*/*"},V=2147483647,ve=new TextEncoder().encode("------WebKitFormBoundaryaxpyiPgbbPti10Rw").length,be=Symbol("stop");class we{constructor(e){p(this,"options");this.options=e}}const Ue=r=>new we(r),De={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,onUploadProgress:!0,fetch:!0,context:!0},He={next:!0},_e={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,duplex:!0},ze=r=>{if(!r)return 0;if(r instanceof FormData){let e=0;for(const[t,s]of r)e+=ve,e+=new TextEncoder().encode(`Content-Disposition: form-data; name="${t}"`).length,e+=typeof s=="string"?new TextEncoder().encode(s).length:s.size;return e}if(r instanceof Blob)return r.size;if(r instanceof ArrayBuffer)return r.byteLength;if(typeof r=="string")return new TextEncoder().encode(r).length;if(r instanceof URLSearchParams)return new TextEncoder().encode(r.toString()).length;if("byteLength"in r)return r.byteLength;if(typeof r=="object"&&r!==null)try{const e=JSON.stringify(r);return new TextEncoder().encode(e).length}catch{return 0}return 0},Re=(r,e,t)=>{let s,o=0;return r.pipeThrough(new TransformStream({transform(a,u){if(u.enqueue(a),s){o+=s.byteLength;let d=e===0?0:o/e;d>=1&&(d=1-Number.EPSILON),t==null||t({percent:d,totalBytes:Math.max(e,o),transferredBytes:o},s)}s=a},flush(){s&&(o+=s.byteLength,t==null||t({percent:1,totalBytes:Math.max(e,o),transferredBytes:o},s))}}))},Je=(r,e)=>{if(!r.body)return r;if(r.status===204)return new Response(null,{status:r.status,statusText:r.statusText,headers:r.headers});const t=Math.max(0,Number(r.headers.get("content-length"))||0);return new Response(Re(r.body,t,e),{status:r.status,statusText:r.statusText,headers:r.headers})},Fe=(r,e,t)=>{if(!r.body)return r;const s=ze(t??r.body);return new Request(r,{duplex:"half",body:Re(r.body,s,e)})},q=r=>r!==null&&typeof r=="object",N=(...r)=>{for(const e of r)if((!q(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return ee({},...r)},Te=(r={},e={})=>{const t=new globalThis.Headers(r),s=e instanceof globalThis.Headers,o=new globalThis.Headers(e);for(const[a,u]of o.entries())s&&u==="undefined"||u===void 0?t.delete(a):t.set(a,u);return t};function L(r,e,t){return Object.hasOwn(e,t)&&e[t]===void 0?[]:ee(r[t]??[],e[t]??[])}const Se=(r={},e={})=>({beforeRequest:L(r,e,"beforeRequest"),beforeRetry:L(r,e,"beforeRetry"),afterResponse:L(r,e,"afterResponse"),beforeError:L(r,e,"beforeError")}),$e=(r,e)=>{const t=new URLSearchParams;for(const s of[r,e])if(s!==void 0)if(s instanceof URLSearchParams)for(const[o,a]of s.entries())t.append(o,a);else if(Array.isArray(s))for(const o of s){if(!Array.isArray(o)||o.length!==2)throw new TypeError("Array search parameters must be provided in [[key, value], ...] format");t.append(String(o[0]),String(o[1]))}else if(q(s))for(const[o,a]of Object.entries(s))a!==void 0&&t.append(o,String(a));else{const o=new URLSearchParams(s);for(const[a,u]of o.entries())t.append(a,u)}return t},ee=(...r)=>{let e={},t={},s={},o;const a=[];for(const u of r)if(Array.isArray(u))Array.isArray(e)||(e=[]),e=[...e,...u];else if(q(u)){for(let[d,f]of Object.entries(u)){if(d==="signal"&&f instanceof globalThis.AbortSignal){a.push(f);continue}if(d==="context"){if(f!=null&&(!q(f)||Array.isArray(f)))throw new TypeError("The `context` option must be an object");e={...e,context:f==null?{}:{...e.context,...f}};continue}if(d==="searchParams"){f==null?o=void 0:o=o===void 0?f:$e(o,f);continue}q(f)&&d in e&&(f=ee(e[d],f)),e={...e,[d]:f}}q(u.hooks)&&(s=Se(s,u.hooks),e.hooks=s),q(u.headers)&&(t=Te(t,u.headers),e.headers=t)}return o!==void 0&&(e.searchParams=o),a.length>0&&(a.length===1?e.signal=a[0]:ye?e.signal=AbortSignal.any(a):e.signal=a.at(-1)),e},Me=r=>ge.includes(r)?r.toUpperCase():r,Be=["get","put","head","delete","options","trace"],Ve=[408,413,429,500,502,503,504],We=[413,429,503],me={limit:2,methods:Be,statusCodes:Ve,afterStatusCodes:We,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:r=>.3*2**(r-1)*1e3,jitter:void 0,retryOnTimeout:!1},Xe=(r={})=>{if(typeof r=="number")return{...me,limit:r};if(r.methods&&!Array.isArray(r.methods))throw new Error("retry.methods must be an array");if(r.methods&&(r.methods=r.methods.map(t=>t.toLowerCase())),r.statusCodes&&!Array.isArray(r.statusCodes))throw new Error("retry.statusCodes must be an array");const e=Object.fromEntries(Object.entries(r).filter(([,t])=>t!==void 0));return{...me,...e}};class X extends Error{constructor(t){super(`Request timed out: ${t.method} ${t.url}`);p(this,"request");this.name="TimeoutError",this.request=t}}async function Ye(r,e,t,s){return new Promise((o,a)=>{const u=setTimeout(()=>{t&&t.abort(),a(new X(r))},s.timeout);s.fetch(r,e).then(o).catch(a).then(()=>{clearTimeout(u)})})}async function Ge(r,{signal:e}){return new Promise((t,s)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",o,{once:!0}));function o(){clearTimeout(a),s(e.reason)}const a=setTimeout(()=>{e==null||e.removeEventListener("abort",o),t()},r)})}const Ke=(r,e)=>{const t={};for(const s in e)Object.hasOwn(e,s)&&!(s in _e)&&!(s in De)&&(!(s in r)||s in He)&&(t[s]=e[s]);return t},Ze=r=>r===void 0?!1:Array.isArray(r)?r.length>0:r instanceof URLSearchParams?r.size>0:typeof r=="object"?Object.keys(r).length>0:typeof r=="string"?r.trim().length>0:!!r;function Qe(r){return r instanceof W||(r==null?void 0:r.name)===W.name}function et(r){return r instanceof X||(r==null?void 0:r.name)===X.name}var J,ke,b,y,m,i,k,R,A,c,U,Ee,Y,D,S,G,xe,P,H,K;const C=class C{constructor(e,t={}){w(this,c);p(this,"request");w(this,b);w(this,y,0);w(this,m);w(this,i);w(this,k);w(this,R);w(this,A);var o,a,u;if(g(this,m,e),g(this,i,{...t,headers:Te(n(this,m).headers,t.headers),hooks:Se({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},t.hooks),method:Me(t.method??n(this,m).method??"GET"),prefixUrl:String(t.prefixUrl||""),retry:Xe(t.retry),throwHttpErrors:t.throwHttpErrors??!0,timeout:t.timeout??1e4,fetch:t.fetch??globalThis.fetch.bind(globalThis),context:t.context??{}}),typeof n(this,m)!="string"&&!(n(this,m)instanceof URL||n(this,m)instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(n(this,i).prefixUrl&&typeof n(this,m)=="string"){if(n(this,m).startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");n(this,i).prefixUrl.endsWith("/")||(n(this,i).prefixUrl+="/"),g(this,m,n(this,i).prefixUrl+n(this,m))}Pe&&ye&&(g(this,R,n(this,i).signal??n(this,m).signal),g(this,b,new globalThis.AbortController),n(this,i).signal=n(this,R)?AbortSignal.any([n(this,R),n(this,b).signal]):n(this,b).signal),de&&(n(this,i).duplex="half"),n(this,i).json!==void 0&&(n(this,i).body=((a=(o=n(this,i)).stringifyJson)==null?void 0:a.call(o,n(this,i).json))??JSON.stringify(n(this,i).json),n(this,i).headers.set("content-type",n(this,i).headers.get("content-type")??"application/json"));const s=t.headers&&new globalThis.Headers(t.headers).has("content-type");if(n(this,m)instanceof globalThis.Request&&(Ne&&n(this,i).body instanceof globalThis.FormData||n(this,i).body instanceof URLSearchParams)&&!s&&n(this,i).headers.delete("content-type"),this.request=new globalThis.Request(n(this,m),n(this,i)),Ze(n(this,i).searchParams)){const f="?"+(typeof n(this,i).searchParams=="string"?n(this,i).searchParams.replace(/^\?/,""):new URLSearchParams(h(u=C,J,ke).call(u,n(this,i).searchParams)).toString()),l=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,f);this.request=new globalThis.Request(l,n(this,i))}if(n(this,i).onUploadProgress){if(typeof n(this,i).onUploadProgress!="function")throw new TypeError("The `onUploadProgress` option must be a function");if(!de)throw new Error("Request streams are not supported in your environment. The `duplex` option for `Request` is not available.");this.request=h(this,c,K).call(this,this.request,n(this,i).body??void 0)}}static create(e,t){var u,d,f;const s=new C(e,t),o=async()=>{var E,T,j,re,se,ne,oe,ie,ae,ce,ue,he;if(typeof n(s,i).timeout=="number"&&n(s,i).timeout>V)throw new RangeError(`The \`timeout\` option cannot be greater than ${V}`);await Promise.resolve();let l=await h(E=s,c,xe).call(E);for(const x of n(s,i).hooks.afterResponse){const O=h(T=s,c,Y).call(T,l.clone());let I;try{I=await x(s.request,h(j=s,c,P).call(j),O,{retryCount:n(s,y)})}catch(Ae){throw h(re=s,c,S).call(re,O),h(se=s,c,S).call(se,l),Ae}if(I instanceof we)throw h(ne=s,c,S).call(ne,O),h(oe=s,c,S).call(oe,l),new B(I.options);const $=I instanceof globalThis.Response?I:l;O!==$&&h(ie=s,c,S).call(ie,O),l!==$&&h(ae=s,c,S).call(ae,l),l=$}if(h(ce=s,c,Y).call(ce,l),!l.ok&&(typeof n(s,i).throwHttpErrors=="function"?n(s,i).throwHttpErrors(l.status):n(s,i).throwHttpErrors)){let x=new W(l,s.request,h(ue=s,c,P).call(ue));for(const O of n(s,i).hooks.beforeError)x=await O(x,{retryCount:n(s,y)});throw x}if(n(s,i).onDownloadProgress){if(typeof n(s,i).onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!Ce)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");const x=l.clone();return h(he=s,c,S).call(he,l),Je(x,n(s,i).onDownloadProgress)}return l},a=h(u=s,c,G).call(u,o).finally(()=>{var E,T;const l=n(s,k);h(E=s,c,D).call(E,(l==null?void 0:l.body)??void 0),h(T=s,c,D).call(T,s.request.body??void 0)});for(const[l,E]of Object.entries(Le))l==="bytes"&&typeof((f=(d=globalThis.Response)==null?void 0:d.prototype)==null?void 0:f.bytes)!="function"||(a[l]=async()=>{s.request.headers.set("accept",s.request.headers.get("accept")||E);const T=await a;if(l==="json"){if(T.status===204)return"";const j=await T.text();return j===""?"":t.parseJson?t.parseJson(j):JSON.parse(j)}return T[l]()});return a}};J=new WeakSet,ke=function(e){return e&&typeof e=="object"&&!Array.isArray(e)&&!(e instanceof URLSearchParams)?Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)):e},b=new WeakMap,y=new WeakMap,m=new WeakMap,i=new WeakMap,k=new WeakMap,R=new WeakMap,A=new WeakMap,c=new WeakSet,U=function(){const e=n(this,i).retry.delay(n(this,y));let t=e;n(this,i).retry.jitter===!0?t=Math.random()*e:typeof n(this,i).retry.jitter=="function"&&(t=n(this,i).retry.jitter(e),(!Number.isFinite(t)||t<0)&&(t=e));const s=n(this,i).retry.backoffLimit??Number.POSITIVE_INFINITY;return Math.min(s,t)},Ee=async function(e){if(le(this,y)._++,n(this,y)>n(this,i).retry.limit)throw e;const t=e instanceof Error?e:new pe(e);if(t instanceof B)return t.customDelay??h(this,c,U).call(this);if(!n(this,i).retry.methods.includes(this.request.method.toLowerCase()))throw e;if(n(this,i).retry.shouldRetry!==void 0){const s=await n(this,i).retry.shouldRetry({error:t,retryCount:n(this,y)});if(s===!1)throw e;if(s===!0)return h(this,c,U).call(this)}if(et(e)&&!n(this,i).retry.retryOnTimeout)throw e;if(Qe(e)){if(!n(this,i).retry.statusCodes.includes(e.response.status))throw e;const s=e.response.headers.get("Retry-After")??e.response.headers.get("RateLimit-Reset")??e.response.headers.get("X-RateLimit-Retry-After")??e.response.headers.get("X-RateLimit-Reset")??e.response.headers.get("X-Rate-Limit-Reset");if(s&&n(this,i).retry.afterStatusCodes.includes(e.response.status)){let o=Number(s)*1e3;Number.isNaN(o)?o=Date.parse(s)-Date.now():o>=Date.parse("2024-01-01")&&(o-=Date.now());const a=n(this,i).retry.maxRetryAfter??o;return o<a?o:a}if(e.response.status===413)throw e}return h(this,c,U).call(this)},Y=function(e){return n(this,i).parseJson&&(e.json=async()=>n(this,i).parseJson(await e.text())),e},D=function(e){e&&e.cancel().catch(()=>{})},S=function(e){h(this,c,D).call(this,e.body??void 0)},G=async function(e){try{return await e()}catch(t){const s=Math.min(await h(this,c,Ee).call(this,t),V);if(n(this,y)<1)throw t;if(await Ge(s,n(this,R)?{signal:n(this,R)}:{}),t instanceof B&&t.customRequest){const o=n(this,i).signal?new globalThis.Request(t.customRequest,{signal:n(this,i).signal}):new globalThis.Request(t.customRequest);h(this,c,H).call(this,o)}for(const o of n(this,i).hooks.beforeRetry){const a=await o({request:this.request,options:h(this,c,P).call(this),error:t,retryCount:n(this,y)});if(a instanceof globalThis.Request){h(this,c,H).call(this,a);break}if(a instanceof globalThis.Response)return a;if(a===be)return}return h(this,c,G).call(this,e)}},xe=async function(){var t;(t=n(this,b))!=null&&t.signal.aborted&&(g(this,b,new globalThis.AbortController),n(this,i).signal=n(this,R)?AbortSignal.any([n(this,R),n(this,b).signal]):n(this,b).signal,this.request=new globalThis.Request(this.request,{signal:n(this,i).signal}));for(const s of n(this,i).hooks.beforeRequest){const o=await s(this.request,h(this,c,P).call(this),{retryCount:n(this,y)});if(o instanceof Response)return o;if(o instanceof globalThis.Request){h(this,c,H).call(this,o);break}}const e=Ke(this.request,n(this,i));return g(this,k,this.request),this.request=n(this,k).clone(),n(this,i).timeout===!1?n(this,i).fetch(n(this,k),e):Ye(n(this,k),e,n(this,b),n(this,i))},P=function(){if(!n(this,A)){const{hooks:e,...t}=n(this,i);g(this,A,Object.freeze(t))}return n(this,A)},H=function(e){g(this,A,void 0),this.request=h(this,c,K).call(this,e)},K=function(e,t){return!n(this,i).onUploadProgress||!e.body?e:Fe(e,n(this,i).onUploadProgress,t??n(this,i).body??void 0)},w(C,J);let z=C;/*! MIT License Â© Sindre Sorhus */const Z=r=>{const e=(t,s)=>z.create(t,N(r,s));for(const t of ge)e[t]=(s,o)=>z.create(s,N(r,o,{method:t}));return e.create=t=>Z(N(t)),e.extend=t=>(typeof t=="function"&&(t=t(r??{})),Z(N(r,t))),e.stop=be,e.retry=Ue,e},tt=Z(),rt="https://api.clockify.me/api/v1";let v=[],Oe=[];const qe=async(r,e={})=>{const{token:t}=F();if(!t)throw new Error("No auth token");return tt.get(`${rt}${r}`,{headers:{"X-Api-Key":t},...e}).json()},ut=Q(_.now().minus({days:1}).toISODate()),F=()=>JSON.parse(localStorage.getItem("clockify_auth")||JSON.stringify({token:"",workspace:"659c1fc8b180a1576ddf8aab",user:""})),st=Q(F());st.subscribe(r=>{localStorage.setItem("clockify_auth",JSON.stringify(r))});const nt=()=>JSON.parse(localStorage.getItem("clockify_mappings")||"[]"),te=Q(nt());te.subscribe(r=>{localStorage.setItem("clockify_mappings",JSON.stringify(r))});const ht=(r,e,t)=>{te.update(s=>{const o={project_name:r.trim(),work_type:e.trim(),task_activity:t.trim()},a=[...s,o].sort((u,d)=>u.project_name.localeCompare(d.project_name));return localStorage.setItem("clockify_mappings",JSON.stringify(a)),a})},ft=r=>{te.update(e=>{const t=e.filter(s=>s.project_name!==r);return localStorage.setItem("clockify_mappings",JSON.stringify(t)),t})},lt=async r=>{const{workspace:e,user:t}=F();if(!e||!t)return[];const s=_.fromISO(r+"T00:00:00Z",{setZone:"utc"}),o=s.startOf("day"),a=s.endOf("day");try{const u=await qe(`/workspaces/${e}/user/${t}/time-entries`,{searchParams:{start:o.toISO(),end:a.toISO(),pageSize:5e3}});return u.sort((d,f)=>new Date(d.timeInterval.start)-new Date(f.timeInterval.start)),Oe=u,u}catch(u){return console.error("Failed to load time entries:",u),[]}},dt=async(r=!1)=>{if(!r&&v.length>0)return v;const{workspace:e}=F();if(!e)return[];try{const t=await qe(`/workspaces/${e}/projects`,{searchParams:{pageSize:5e3,archived:!1}});return v=t,t}catch(t){return console.error("Failed to load projects:",t),v||[]}};function ot(r,e=30){const t=_.fromISO(r.timeInterval.start,{zone:"utc"}),s=_.fromISO(r.timeInterval.end,{zone:"utc"}),o=[];let a=t;for(;a<s;){const u=a.plus({minutes:e}),d=u<s?u:s;o.push({description:r.description,projectId:r.projectId,start:a,end:d}),a=d}return o}const mt=()=>Oe.map(e=>ot(e)).flat();export{dt as a,st as b,mt as c,ht as d,ft as e,lt as l,te as m,ut as s};
